\PassOptionsToPackage{svgnames,dvipsnames,svgnames}{xcolor}
%% For double-blind review submission
\documentclass[acmsmall,review,anonymous]{acmart}\settopmatter{printfolios=true}
%% For single-blind review submission
%\documentclass[acmlarge,review]{acmart}\settopmatter{printfolios=true}
%% For final camera-ready submission
%\documentclass[acmlarge]{acmart}\settopmatter{}

%% Note: Authors migrating a paper from PACMPL format to traditional
%% SIGPLAN proceedings format should change 'acmlarge' to
%% 'sigplan,10pt'.

\bibliographystyle{ACM-Reference-Format}


%% Some recommended packages.
\usepackage{booktabs}   %% For formal tables:
                        %% http://ctan.org/pkg/booktabs
\usepackage{subcaption} %% For complex figures with subfigures/subcaptions
                        %% http://ctan.org/pkg/subcaption

%% Cyrus packages
\usepackage{microtype}
\usepackage{mdframed}
\usepackage{colortab}
\usepackage{mathpartir}
\usepackage{enumitem}
\usepackage{bbm}
\usepackage{stmaryrd}
\usepackage{mathtools}
\usepackage{leftidx}
\usepackage{todonotes}

\usepackage{listings}%
\lstloadlanguages{ML}
\lstset{tabsize=2, 
basicstyle=\footnotesize\ttfamily, 
% keywordstyle=\sffamily,
commentstyle=\itshape\ttfamily\color{gray}, 
stringstyle=\ttfamily\color{purple},
mathescape=false,escapechar=\#,
numbers=left, numberstyle=\scriptsize\color{gray}\ttfamily, language=ML, showspaces=false,showstringspaces=false,xleftmargin=15pt, 
morekeywords={string, float, int},
classoffset=0,belowskip=\smallskipamount, aboveskip=\smallskipamount
}
\let\li\lstinline


%% Joshua Dunfield macros
\def\OPTIONConf{1}%
\usepackage{joshuadunfield}


% \newtheorem{theorem}{Theorem}[chapter]
% \newtheorem{lemma}[theorem]{Lemma}
% \newtheorem{corollary}[theorem]{Corollary}
% \newtheorem{definition}[theorem]{Definition}
% \newtheorem{assumption}[theorem]{Assumption}
% \newtheorem{condition}[theorem]{Condition}


%% Listings
\makeatletter\if@ACM@journal\makeatother
%% Journal information (used by PACMPL format)
%% Supplied to authors by publisher for camera-ready submission
\acmJournal{PACMPL}
\acmVolume{1}
\acmNumber{1}
\acmArticle{1}
\acmYear{2018}
\acmMonth{1}
\acmDOI{10.1145/nnnnnnn.nnnnnnn}
\startPage{1}
\else\makeatother
%% Conference information (used by SIGPLAN proceedings format)
%% Supplied to authors by publisher for camera-ready submission
\acmConference[PL'18]{ACM SIGPLAN Conference on Programming Languages}{January 01--03, 2017}{New York, NY, USA}
\acmYear{2018}
\acmISBN{978-x-xxxx-xxxx-x/YY/MM}
\acmDOI{10.1145/nnnnnnn.nnnnnnn}
\startPage{1}
\fi


%% Copyright information
%% Supplied to authors (based on authors' rights management selection;
%% see authors.acm.org) by publisher for camera-ready submission
\setcopyright{none}             %% For review submission
%\setcopyright{acmcopyright}
%\setcopyright{acmlicensed}
%\setcopyright{rightsretained}
%\copyrightyear{2017}           %% If different from \acmYear


%% Bibliography style
\bibliographystyle{ACM-Reference-Format}
%% Citation style
%% Note: author/year citations are required for papers published as an
%% issue of PACMPL.
\citestyle{acmauthoryear}   %% For author/year citations

\input{commands}
\input{macros}


\begin{document}

%% Title information
\title{Live Functional Programming with Typed Holes}         %% [Short Title] is optional;
                                        %% when present, will be used in
                                        %% header instead of Full Title.
% \titlenote{with title note}             %% \titlenote is optional;
                                        %% can be repeated if necessary;
                                        %% contents suppressed with 'anonymous'
% \subtitle{Subtitle}                     %% \subtitle is optional
% \subtitlenote{with subtitle note}       %% \subtitlenote is optional;
                                        %% can be repeated if necessary;
                                        %% contents suppressed with 'anonymous'


%% Author information
%% Contents and number of authors suppressed with 'anonymous'.
%% Each author should be introduced by \author, followed by
%% \authornote (optional), \orcid (optional), \affiliation, and
%% \email.
%% An author may have multiple affiliations and/or emails; repeat the
%% appropriate command.
%% Many elements are not rendered, but should be provided for metadata
%% extraction tools.

%% Author with single affiliation.
\author{First1 Last1}
\authornote{with author1 note}          %% \authornote is optional;
                                        %% can be repeated if necessary
\orcid{nnnn-nnnn-nnnn-nnnn}             %% \orcid is optional
\affiliation{
  \position{Position1}
  \department{Department1}              %% \department is recommended
  \institution{Institution1}            %% \institution is required
  \streetaddress{Street1 Address1}
  \city{City1}
  \state{State1}
  \postcode{Post-Code1}
  \country{Country1}
}
\email{first1.last1@inst1.edu}          %% \email is recommended

%% Author with two affiliations and emails.
\author{First2 Last2}
\authornote{with author2 note}          %% \authornote is optional;
                                        %% can be repeated if necessary
\orcid{nnnn-nnnn-nnnn-nnnn}             %% \orcid is optional
\affiliation{
  \position{Position2a}
  \department{Department2a}             %% \department is recommended
  \institution{Institution2a}           %% \institution is required
  \streetaddress{Street2a Address2a}
  \city{City2a}
  \state{State2a}
  \postcode{Post-Code2a}
  \country{Country2a}
}
\email{first2.last2@inst2a.com}         %% \email is recommended
\affiliation{
  \position{Position2b}
  \department{Department2b}             %% \department is recommended
  \institution{Institution2b}           %% \institution is required
  \streetaddress{Street3b Address2b}
  \city{City2b}
  \state{State2b}
  \postcode{Post-Code2b}
  \country{Country2b}
}
\email{first2.last2@inst2b.org}         %% \email is recommended


%% Paper note
%% The \thanks command may be used to create a "paper note" ---
%% similar to a title note or an author note, but not explicitly
%% associated with a particular element.  It will appear immediately
%% above the permission/copyright statement.
% \thanks{with paper note}                %% \thanks is optional
                                        %% can be repeated if necesary
                                        %% contents suppressed with 'anonymous'


%% Abstract
%% Note: \begin{abstract}...\end{abstract} environment must come
%% before \maketitle command
\begin{abstract}
\emph{Live programming environments} are designed to provide programmers (and, in some cases, audiences) with rapid and continuous feedback about a program's dynamic behavior throughout the editing process. The problem is that programming languages typically assign dynamic meaning only to programs that are syntactically well-formed and free of static type errors (collectively, \emph{complete programs}), whereas programming environments often encounter edit states that do not correspond to complete programs. Recent work by \citet{popl-paper} has made progress on this problem of working with incomplete programs by developing a type system for lambda terms with \emph{holes} in both expression and type position, with empty holes standing for missing expressions or types, and non-empty holes operating as ``membranes'' around type inconsistencies. This paper contributes a complementary dynamic semantics, i.e. one that assigns dynamic meaning to every incomplete program accepted by the type system in the prior work. Of course, it would not be entirely satisfying to assign trivial dynamic meaning to incomplete programs, e.g. by simply raising an exception as soon as evaluation first encounters a hole (as in some existing systems). Instead, evaluation proceeds ``around'' expression holes, performing as much computation as is possible while also tracking the dynamic environment around each expression hole as it flows through the program. These hole environments can be reported directly to the programmer as they work to fill the hole, and they also support an ``edit-and-resume'' feature for edits that amount to hole filling, rather than requiring that evaluation restart after each such edit. Formally, our semantics incorporates features from both gradual type theory (to support evaluation of terms with type holes) and contextual modal type theory (CMTT, to support environment tracking), combined with technical novelties necessary to maintain type safety in the presence of expression holes (i.e. free metavariables, from the perspective of CMTT) and prove the commutativity and confluence properties that guarantee that the ``edit-and-resume'' feature is sound. The primary focus of this paper is on these theoretical properties, which we have mechanized using the Agda proof assistant. We additionally describe a simple reference implementation, called Hazelnut Live, that exposes a language of structured edit actions based on those defined in the prior work by \citet{popl-paper} that insert holes as necessary to guarantee that every edit state has some (possibly incomplete) type. This property, together with the type safety property we prove, results in a live functional programming environment where feedback never lags the edit state, i.e. \emph{every edit state is guaranteed to have non-trivial static and dynamic meaning}.

%In our system, evaluation treats failed casts much like it treats expression holes (rather than immediately failing with a cast error, as in gradual type theory). Prior work on contextual modal type theory did not develop an operational semantics for programs with free metavariables, which correspond to programs with holes in our formulation. 


% These incomplete edit states are sometimes transient, but at other times, they persist for extended periods of time, e.g. when the programmer is filling in the branches of a large case analysis one-by-one, or when an edit causes type errors to appear throughout a program. %This gap can cause live programming services to lag behind the programmer's edits, in many cases for an extended period of time.



% 





%
% However, live programming services typically cannot run incomplete
% programs, or they raise an exception as soon as a hole is encountered
% during evaluation.
% %
% %% When they % encounter an incomplete program, a common strategy is
% %to simply % disable the live programming service, or revert to the
% %last complete % edit state.
% %
% This deprives the programmer, and also other editor services, of
% potentially valuable feedback about the dynamic behavior of the
% visible program. Our second track of research will address this gap by defining a dynamic semantics for incomplete programs. We plan to focus the first year of research efforts largely on this track of research, as indicated in \autoref{fig:tracks}. 
% % Evaluation of incomplete programs will proceed as far as possible past the hole, and in the process, will track the environment around each hole instance.
% This semantics will support live programming services like that outlined in our example above, which provides the programmer with a result on every, or nearly every, edit and allows the programmer to choose a hole instance in the computed result of evaluation and inspect its environment (in the sidebar of \autoref{fig:intro-example}) while they determine how to best fill that hole. 
% Tracking each hole instance's environment will also enhance the editor services specified by the remaining two tracks of research, \ie{}~the action suggestion panel (\trackThree{}) and the direct manipulation programming service (\trackFour{}).
% % We will prove that in certain situations, hole filling commutes with evaluation.
% % This formal observation will lead to a decrease in the cost of providing continuous feedback to the programmer on every edit by avoiding redundant recomputation.
% Our preliminary work, described in a presentation at the \emph{LIVE 2017}
% workshop~\cite{HazelLIVE}, has discovered encouraging connections between our proposed dynamics and previous research on contextual modal type theory (the Curry-Howard interpretation of contextual modal logic) \cite{Nanevski2008} and gradual type theory \cite{Siek06a}.


\end{abstract}


%% 2012 ACM Computing Classification System (CSS) concepts
%% Generate at 'http://dl.acm.org/ccs/ccs.cfm'.
% \begin{CCSXML}
% <ccs2012>
% <concept>
% <concept_id>10011007.10011006.10011008</concept_id>
% <concept_desc>Software and its engineering~General programming languages</concept_desc>
% <concept_significance>500</concept_significance>
% </concept>
% <concept>
% <concept_id>10003456.10003457.10003521.10003525</concept_id>
% <concept_desc>Social and professional topics~History of programming languages</concept_desc>
% <concept_significance>300</concept_significance>
% </concept>
% </ccs2012>
% \end{CCSXML}

% \ccsdesc[500]{Software and its engineering~General programming languages}
% \ccsdesc[300]{Social and professional topics~History of programming languages}
%% End of generated code


%% Keywords
%% comma separated list
% \keywords{keyword1, keyword2, keyword3}  %% \keywords is optional


%% \maketitle
%% Note: \maketitle command must come after title commands, author
%% commands, abstract environment, Computing Classification System
%% environment and commands, and keywords command.
\maketitle

\input{intro}
\input{examples}
\input{calculus}
\input{related-work}
\input{discussion}

\bibliography{references,all.short,hazel_NSF}

\clearpage
\appendix
\cy{for the submission, appendix should be separated into a separate supplemental PDF}

\input{extensions}

\end{document}
